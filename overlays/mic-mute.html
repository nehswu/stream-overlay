<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Mic Mute Overlay</title>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        width: 100vw;
        height: 100vh;
        background: transparent;
      }

      .mic-container {
        position: fixed;
        bottom: 100px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 99999;
        width: 100px;
        height: 100px;
        display: none;
        animation: pulse 2.5s infinite ease-in-out;
      }

      .mic-container img {
        width: 100px;
        height: 100px;
        object-fit: cover;
        pointer-events: none;
      }

      @keyframes pulse {
        0% {
          transform: translateX(-50%) scale(1);
        }
        50% {
          transform: translateX(-50%) scale(1.25);
        }
        100% {
          transform: translateX(-50%) scale(1);
        }
      }
    </style>
  </head>
  <body>
    <div class="mic-container" id="micMute">
      <img src="/assets/mic-mute.png" alt="Mic Mute" />
    </div>

    <script>
      const mic = document.getElementById("micMute");
      let messageQueue = [];

      // Buffer messages until DOM is ready
      window.addEventListener("message", function (event) {
        console.log("Mic overlay received:", event.data);
        messageQueue.push(event.data);
        processQueue();
      });

      function processQueue() {
        if (!mic || messageQueue.length === 0) return;

        const msg = messageQueue.shift();

        if (msg.overlay === "mic") {
          mic.style.display = msg.show ? "block" : "none";
          console.log(
            "Mic container display set to:",
            msg.show ? "block" : "none"
          );
        }
      }

      window.addEventListener("DOMContentLoaded", () => {
        console.log("DOM loaded in mic overlay");
        processQueue(); // Process any early messages
      });
    </script>
  </body>
</html>
